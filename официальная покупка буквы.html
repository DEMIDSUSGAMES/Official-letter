<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ö—É–ø–∏—Ç—å –±—É–∫–≤—ã</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg: #000000;
  --card: #111111;
  --text: #ffffff;
  --muted: #888888;
  --accent: #1ea7ff;
  --success: #2ed573;
  --border: 1px solid #222222;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

body {
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

/* –®–ê–ü–ö–ê */
.header {
  text-align: center;
  padding: 30px 0;
  margin-bottom: 20px;
}

.logo {
  font-size: 32px;
  font-weight: 800;
  background: linear-gradient(90deg, #1ea7ff, #8be9fd);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 8px;
}

.subtitle {
  color: var(--muted);
  font-size: 14px;
}

/* –ö–ê–†–¢–û–ß–ö–ò –¢–û–í–ê–†–û–í */
.products-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 15px;
  margin-bottom: 30px;
}

.product-card {
  background: linear-gradient(145deg, #0f0f0f, #0a0a0a);
  border-radius: 16px;
  padding: 20px;
  border: var(--border);
  transition: all 0.2s;
}

.product-card:hover {
  border-color: var(--accent);
}

.card-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 20px;
  margin-bottom: 10px;
}

.card-title i {
  color: var(--accent);
}

.card-desc {
  color: var(--muted);
  margin-bottom: 15px;
  font-size: 14px;
}

.card-price {
  font-size: 28px;
  font-weight: 800;
  color: var(--accent);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.price-old {
  text-decoration: line-through;
  color: var(--muted);
  font-size: 16px;
}

.discount {
  background: rgba(46, 213, 115, 0.2);
  color: var(--success);
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: bold;
}

.buy-btn {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #1ea7ff, #0d8ce0);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 10px;
}

/* –ù–ò–ñ–ù–Ø–Ø –ú–ï–ù–Æ–®–ö–ê */
.bottom-sheet {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #111111;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  padding: 20px;
  transform: translateY(100%);
  transition: transform 0.3s ease;
  z-index: 1000;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
}

.bottom-sheet.active {
  transform: translateY(0);
}

.sheet-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: var(--border);
}

.sheet-title {
  font-size: 20px;
  font-weight: 700;
}

.close-btn {
  background: none;
  border: none;
  color: var(--muted);
  font-size: 24px;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.05);
}

/* –í–´–ë–û–† –ë–£–ö–í –í –ú–ï–ù–Æ–®–ö–ï */
.letters-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 10px;
  margin-bottom: 20px;
  max-height: 300px;
  overflow-y: auto;
  padding: 10px;
}

.letter-option {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.03);
  border: var(--border);
  border-radius: 12px;
  font-size: 22px;
  font-weight: 800;
  color: var(--text);
  cursor: pointer;
  transition: all 0.2s;
}

.letter-option:hover {
  background: rgba(255, 255, 255, 0.08);
}

.letter-option.selected {
  background: linear-gradient(135deg, #1ea7ff, #0d8ce0);
  color: white;
  border-color: transparent;
  transform: scale(1.05);
}

.selection-info {
  text-align: center;
  margin-top: 20px;
  padding-top: 20px;
  border-top: var(--border);
}

.selection-info h3 {
  font-size: 18px;
  margin-bottom: 10px;
}

.selection-price {
  font-size: 24px;
  font-weight: bold;
  color: var(--accent);
  margin-bottom: 20px;
}

/* –§–û–†–ú–ê –û–ü–õ–ê–¢–´ –í –ú–ï–ù–Æ–®–ö–ï */
.form-group {
  margin-bottom: 15px;
}

.form-label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
  color: var(--muted);
}

.form-input {
  width: 100%;
  padding: 12px;
  background: rgba(255, 255, 255, 0.03);
  border: var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 16px;
}

.form-input:focus {
  border-color: var(--accent);
  outline: none;
}

.input-row {
  display: flex;
  gap: 10px;
}

.input-row .form-group {
  flex: 1;
}

/* –ì–ê–õ–û–ß–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø */
.save-card-checkbox {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 15px 0;
  padding: 10px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
  cursor: pointer;
}

.save-card-checkbox input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--accent);
}

.save-card-checkbox label {
  cursor: pointer;
  font-size: 14px;
  color: var(--muted);
}

/* –ö–ù–û–ü–ö–ò –í –ú–ï–ù–Æ–®–ö–ï */
.sheet-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.sheet-btn {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.sheet-btn.secondary {
  background: rgba(255, 255, 255, 0.05);
  color: var(--text);
  border: var(--border);
}

.sheet-btn.primary {
  background: linear-gradient(135deg, #1ea7ff, #0d8ce0);
  color: white;
}

/* –°–ï–†–¢–ò–§–ò–ö–ê–¢ */
.certificate-section {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  padding: 20px;
}

.certificate-section.active {
  display: flex;
}

.certificate-content {
  background: linear-gradient(145deg, #0f0f0f, #0a0a0a);
  border-radius: 20px;
  padding: 30px;
  border: 2px solid var(--accent);
  max-width: 500px;
  width: 100%;
  text-align: center;
}

.certificate-letter {
  font-size: 80px;
  font-weight: 900;
  color: var(--accent);
  margin: 20px 0;
  text-shadow: 0 0 30px rgba(30, 167, 255, 0.3);
}

.certificate-info {
  font-size: 18px;
  margin-bottom: 10px;
}

.certificate-details {
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 30px;
}

/* –ò–°–¢–û–†–ò–Ø –ü–û–ö–£–ü–û–ö */
.recent-purchases {
  margin-top: 40px;
  padding-top: 30px;
  border-top: var(--border);
}

.section-title {
  font-size: 20px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.purchases-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 15px;
}

.purchase-item {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  padding: 15px;
  text-align: center;
  border: var(--border);
  cursor: pointer;
  transition: all 0.2s;
}

.purchase-item:hover {
  background: rgba(255, 255, 255, 0.06);
  transform: translateY(-2px);
}

.purchase-letter {
  font-size: 32px;
  font-weight: 900;
  color: var(--accent);
  margin-bottom: 8px;
}

.purchase-name {
  font-size: 14px;
  margin-bottom: 5px;
}

.purchase-date {
  font-size: 12px;
  color: var(--muted);
}

.no-purchases {
  text-align: center;
  padding: 40px 20px;
  color: var(--muted);
  grid-column: 1 / -1;
}

/* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(15, 15, 15, 0.95);
  border-radius: 12px;
  padding: 15px;
  border-left: 4px solid var(--accent);
  display: none;
  align-items: center;
  gap: 12px;
  z-index: 3000;
  max-width: 350px;
  animation: slideIn 0.3s;
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.notification.active {
  display: flex;
}

.notification-icon {
  font-size: 20px;
  color: var(--accent);
}

.notification-content {
  flex: 1;
}

.notification-title {
  font-weight: 700;
  margin-bottom: 4px;
}

.notification-message {
  font-size: 14px;
  color: var(--muted);
}

/* –§–£–¢–ï–† */
.footer {
  text-align: center;
  padding: 30px 0 20px;
  color: var(--muted);
  font-size: 13px;
  border-top: var(--border);
  margin-top: 40px;
}

/* –ê–î–ê–ü–¢–ò–í */
@media (max-width: 600px) {
  .container {
    padding: 15px;
  }
  
  .letters-grid {
    grid-template-columns: repeat(5, 1fr);
  }
  
  .purchases-list {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .input-row {
    flex-direction: column;
    gap: 0;
  }
}
</style>
</head>
<body>
<div class="container">
  <!-- –®–ê–ü–ö–ê -->
  <div class="header">
    <div class="logo">–ö—É–ø–∏—Ç—å –±—É–∫–≤—É</div>
    <div class="subtitle">–ü—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±—É–∫–≤—ã</div>
  </div>

  <!-- –ö–ê–¢–ê–õ–û–ì –¢–û–í–ê–†–û–í -->
  <div class="products-grid">
    <!-- –†–£–°–°–ö–ê–Ø –ë–£–ö–í–ê -->
    <div class="product-card">
      <div class="card-title">
        <i class="fas fa-cyrillic"></i>
        <span>–†—É—Å—Å–∫–∞—è –±—É–∫–≤–∞</span>
      </div>
      <div class="card-desc">–í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é –±—É–∫–≤—É —Ä—É—Å—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞</div>
      <div class="card-price">
        <span class="price-old">25 ‚ÇΩ</span>
        20 ‚ÇΩ
        <span class="discount">-20%</span>
      </div>
      <button class="buy-btn" onclick="openLetterSheet('russian')">
        <i class="fas fa-shopping-cart"></i>
        –ö—É–ø–∏—Ç—å –±—É–∫–≤—É
      </button>
    </div>

    <!-- –ê–ù–ì–õ–ò–ô–°–ö–ê–Ø –ë–£–ö–í–ê -->
    <div class="product-card">
      <div class="card-title">
        <i class="fas fa-language"></i>
        <span>–ê–Ω–≥–ª–∏–π—Å–∫–∞—è –±—É–∫–≤–∞</span>
      </div>
      <div class="card-desc">–õ—é–±–∞—è –±—É–∫–≤–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞</div>
      <div class="card-price">25 ‚ÇΩ</div>
      <button class="buy-btn" onclick="openLetterSheet('english')">
        <i class="fas fa-shopping-cart"></i>
        –ö—É–ø–∏—Ç—å –±—É–∫–≤—É
      </button>
    </div>

    <!-- –í–ï–°–¨ –†–£–°–°–ö–ò–ô –ê–õ–§–ê–í–ò–¢ -->
    <div class="product-card">
      <div class="card-title">
        <i class="fas fa-gem"></i>
        <span>–í–µ—Å—å —Ä—É—Å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç</span>
      </div>
      <div class="card-desc">–í—Å–µ 33 –±—É–∫–≤—ã —Ä—É—Å—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞</div>
      <div class="card-price">
        <span class="price-old">660 ‚ÇΩ</span>
        566 ‚ÇΩ
        <span class="discount">-14%</span>
      </div>
      <button class="buy-btn" onclick="buyFullAlphabet()">
        <i class="fas fa-shopping-cart"></i>
        –ö—É–ø–∏—Ç—å –≤–µ—Å—å –∞–ª—Ñ–∞–≤–∏—Ç
      </button>
    </div>
  </div>

  <!-- –ò–°–¢–û–†–ò–Ø –ü–û–ö–£–ü–û–ö -->
  <div class="recent-purchases">
    <div class="section-title">
      <i class="fas fa-history"></i>
      <span>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</span>
    </div>
    <div id="purchasesContainer" class="purchases-list">
      <!-- –ë—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
    </div>
  </div>

  <!-- –§–£–¢–ï–† -->
  <div class="footer">
    –î–ª—è —Å–≤—è–∑–∏: Telegram @Demid_Ca ‚Ä¢ –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞—â–∏—â–µ–Ω—ã
  </div>
</div>

<!-- –ù–ò–ñ–ù–Ø–Ø –ú–ï–ù–Æ–®–ö–ê –í–´–ë–û–†–ê –ë–£–ö–í -->
<div class="bottom-sheet" id="letterSheet">
  <div class="sheet-header">
    <div class="sheet-title" id="sheetTitle">–í—ã–±–µ—Ä–∏—Ç–µ –±—É–∫–≤—É</div>
    <button class="close-btn" onclick="closeSheet('letterSheet')">&times;</button>
  </div>
  
  <div class="letters-grid" id="lettersContainer">
    <!-- –ë—É–∫–≤—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
  </div>
  
  <div class="selection-info">
    <h3>–í—ã–±—Ä–∞–Ω–æ: <span id="selectedLetterText">‚Äî</span></h3>
    <div class="selection-price" id="selectedLetterPrice">0 ‚ÇΩ</div>
    
    <div class="sheet-buttons">
      <button class="sheet-btn secondary" onclick="closeSheet('letterSheet')">
        –û—Ç–º–µ–Ω–∞
      </button>
      <button class="sheet-btn primary" onclick="openPaymentSheet()" id="proceedBtn" disabled>
        <i class="fas fa-arrow-right"></i>
        –î–∞–ª–µ–µ
      </button>
    </div>
  </div>
</div>

<!-- –ù–ò–ñ–ù–Ø–Ø –ú–ï–ù–Æ–®–ö–ê –û–ü–õ–ê–¢–´ -->
<div class="bottom-sheet" id="paymentSheet">
  <div class="sheet-header">
    <div class="sheet-title" id="paymentTitle">–û–ø–ª–∞—Ç–∞</div>
    <button class="close-btn" onclick="closeSheet('paymentSheet')">&times;</button>
  </div>
  
  <div id="paymentInfo" style="margin-bottom: 20px;">
    <div style="font-size: 18px; margin-bottom: 5px;" id="productName">–†—É—Å—Å–∫–∞—è –±—É–∫–≤–∞ "–ê"</div>
    <div style="font-size: 24px; font-weight: bold; color: var(--accent);" id="productPrice">20 ‚ÇΩ</div>
  </div>
  
  <div class="form-group">
    <label class="form-label">–í–∞—à–µ –∏–º—è –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</label>
    <input type="text" class="form-input" id="buyerName" placeholder="–ö–∞–∫ –≤–∞—Å —É–∫–∞–∑–∞—Ç—å –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ?">
  </div>
  
  <div class="form-group">
    <label class="form-label">–ù–æ–º–µ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã</label>
    <input type="text" class="form-input" id="cardNumber" placeholder="0000 0000 0000 0000" maxlength="19">
  </div>
  
  <div class="input-row">
    <div class="form-group">
      <label class="form-label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–ú–ú/–ì–ì)</label>
      <input type="text" class="form-input" id="cardExpiry" placeholder="12/25" maxlength="5">
    </div>
    <div class="form-group">
      <label class="form-label">CVC/CVV</label>
      <input type="text" class="form-input" id="cardCVC" placeholder="123" maxlength="4">
    </div>
  </div>
  
  <div class="save-card-checkbox">
    <input type="checkbox" id="saveCardData">
    <label for="saveCardData">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ–∫—É–ø–æ–∫</label>
  </div>
  
  <div style="background: rgba(255, 71, 87, 0.1); padding: 12px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #ff4757;">
    <div style="font-size: 13px; color: #ffdddd;">
      ‚ö†Ô∏è –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û–ø–ª–∞—Ç–∏—Ç—å" —Å –∫–∞—Ä—Ç—ã —Å–ø–∏—à–µ—Ç—Å—è <span id="paymentAmountDisplay">20</span> ‚ÇΩ
    </div>
  </div>
  
  <div class="sheet-buttons">
    <button class="sheet-btn secondary" onclick="closeSheet('paymentSheet')">
      –û—Ç–º–µ–Ω–∞
    </button>
    <button class="sheet-btn primary" onclick="processPayment()" id="payBtn">
      <i class="fas fa-lock"></i>
      –û–ø–ª–∞—Ç–∏—Ç—å <span id="paymentAmount">20</span> ‚ÇΩ
    </button>
  </div>
</div>

<!-- –°–ï–†–¢–ò–§–ò–ö–ê–¢ (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
<div class="certificate-section" id="certificateSection">
  <div class="certificate-content">
    <div class="sheet-title">
      <i class="fas fa-certificate"></i> –í–∞—à —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
    </div>
    
    <div class="certificate-letter" id="certificateLetter">A</div>
    <div class="certificate-info" id="certificateOwner">–í–ª–∞–¥–µ–ª–µ—Ü: ‚Äî</div>
    <div class="certificate-details" id="certificateDetails">ID: ‚Äî ‚Ä¢ –î–∞—Ç–∞: ‚Äî ‚Ä¢ –¶–µ–Ω–∞: ‚Äî</div>
    
    <div class="sheet-buttons" style="margin-top: 30px;">
      <button class="sheet-btn secondary" onclick="closeCertificate()">
        <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
      </button>
      <button class="sheet-btn primary" onclick="downloadCertificate()">
        <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å
      </button>
    </div>
  </div>
</div>

<!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
<div class="notification" id="notification">
  <div class="notification-icon">
    <i class="fas fa-check-circle"></i>
  </div>
  <div class="notification-content">
    <div class="notification-title" id="notificationTitle">–£—Å–ø–µ—à–Ω–æ!</div>
    <div class="notification-message" id="notificationMessage">–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞</div>
  </div>
</div>

<script>
// –ö–û–ù–°–¢–ê–ù–¢–´
const PRICES = {
  russian: 20,
  english: 25,
  fullRussian: 566
};

// –ü–ï–†–ï–ú–ï–ù–ù–´–ï
let currentProduct = null;
let selectedLetter = null;

// –ê–õ–§–ê–í–ò–¢–´
const russianAlphabet = '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø'.split('');
const englishAlphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
function init() {
  loadPurchases();
  loadSavedCardData();
  setupEventListeners();
}

// –ó–ê–ì–†–£–ó–ö–ê –°–û–•–†–ê–ù–ï–ù–ù–´–• –î–ê–ù–ù–´–•
function loadSavedCardData() {
  const savedData = JSON.parse(localStorage.getItem('savedCardData') || 'null');
  if (savedData) {
    document.getElementById('cardNumber').value = savedData.cardNumber;
    document.getElementById('cardExpiry').value = savedData.cardExpiry;
    document.getElementById('cardCVC').value = savedData.cardCVC;
    document.getElementById('buyerName').value = savedData.buyerName || '';
    document.getElementById('saveCardData').checked = true;
  }
}

// –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•
function saveCardData() {
  const saveCard = document.getElementById('saveCardData').checked;
  const buyerName = document.getElementById('buyerName').value.trim();
  const cardNumber = document.getElementById('cardNumber').value;
  const cardExpiry = document.getElementById('cardExpiry').value;
  const cardCVC = document.getElementById('cardCVC').value;
  
  if (saveCard && cardNumber && cardExpiry && cardCVC) {
    const cardData = {
      buyerName: buyerName,
      cardNumber: cardNumber,
      cardExpiry: cardExpiry,
      cardCVC: cardCVC
    };
    localStorage.setItem('savedCardData', JSON.stringify(cardData));
  } else if (!saveCard) {
    localStorage.removeItem('savedCardData');
  }
}

// –ó–ê–ì–†–£–ó–ö–ê –ò–°–¢–û–†–ò–ò –ü–û–ö–£–ü–û–ö
function loadPurchases() {
  const purchases = JSON.parse(localStorage.getItem('letterPurchases') || '[]');
  const container = document.getElementById('purchasesContainer');
  
  if (purchases.length === 0) {
    container.innerHTML = '<div class="no-purchases">–ü–æ–∫—É–ø–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
  } else {
    const recent = purchases.slice(0, 6);
    container.innerHTML = recent.map(p => `
      <div class="purchase-item" onclick="showCertificateFromHistory('${p.id}')">
        <div class="purchase-letter">${p.symbol}</div>
        <div class="purchase-name">${p.name}</div>
        <div class="purchase-date">${p.date.split(' ')[0]}</div>
      </div>
    `).join('');
  }
}

// –ù–ê–°–¢–†–û–ô–ö–ê –°–û–ë–´–¢–ò–ô
function setupEventListeners() {
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
  document.getElementById('cardNumber').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{4})/g, '$1 ').trim();
    e.target.value = value.substring(0, 19);
  });
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
  document.getElementById('cardExpiry').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 2) {
      value = value.substring(0, 2) + '/' + value.substring(2, 4);
    }
    e.target.value = value.substring(0, 5);
  });
}

// –û–¢–ö–†–´–¢–ò–ï –ú–ï–ù–Æ–®–ö–ò –í–´–ë–û–†–ê –ë–£–ö–í
function openLetterSheet(type) {
  currentProduct = { type: type, price: type === 'russian' ? PRICES.russian : PRICES.english };
  selectedLetter = null;
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
  const title = type === 'russian' ? '–í—ã–±–µ—Ä–∏—Ç–µ —Ä—É—Å—Å–∫—É—é –±—É–∫–≤—É' : '–í—ã–±–µ—Ä–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –±—É–∫–≤—É';
  document.getElementById('sheetTitle').textContent = title;
  
  // –û—á–∏—Å—Ç–∫–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É–∫–≤–∞–º–∏
  const container = document.getElementById('lettersContainer');
  container.innerHTML = '';
  
  const alphabet = type === 'russian' ? russianAlphabet : englishAlphabet;
  alphabet.forEach(letter => {
    const btn = document.createElement('button');
    btn.className = 'letter-option';
    btn.textContent = letter;
    btn.onclick = () => selectLetter(letter);
    container.appendChild(btn);
  });
  
  // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
  document.getElementById('selectedLetterText').textContent = '‚Äî';
  document.getElementById('selectedLetterPrice').textContent = '0 ‚ÇΩ';
  document.getElementById('proceedBtn').disabled = true;
  
  // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é—à–∫—É
  closeSheet('paymentSheet');
  openSheet('letterSheet');
}

// –í–´–ë–û–† –ë–£–ö–í–´
function selectLetter(letter) {
  selectedLetter = letter;
  
  // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö
  document.querySelectorAll('.letter-option').forEach(el => {
    el.classList.remove('selected');
  });
  
  // –í—ã–¥–µ–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é
  event.target.classList.add('selected');
  
  // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
  document.getElementById('selectedLetterText').textContent = `"${letter}"`;
  document.getElementById('selectedLetterPrice').textContent = `${currentProduct.price} ‚ÇΩ`;
  document.getElementById('proceedBtn').disabled = false;
}

// –û–¢–ö–†–´–¢–ò–ï –ú–ï–ù–Æ–®–ö–ò –û–ü–õ–ê–¢–´
function openPaymentSheet() {
  if (!selectedLetter) return;
  
  // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∫—É–ø–∫–µ
  const productName = currentProduct.type === 'russian' ? `–†—É—Å—Å–∫–∞—è –±—É–∫–≤–∞ "${selectedLetter}"` : `–ê–Ω–≥–ª–∏–π—Å–∫–∞—è –±—É–∫–≤–∞ "${selectedLetter}"`;
  document.getElementById('productName').textContent = productName;
  document.getElementById('productPrice').textContent = `${currentProduct.price} ‚ÇΩ`;
  document.getElementById('paymentAmount').textContent = currentProduct.price;
  document.getElementById('paymentAmountDisplay').textContent = currentProduct.price;
  
  // –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é—à–∫—É –≤—ã–±–æ—Ä–∞, –æ—Ç–∫—Ä—ã—Ç—å –æ–ø–ª–∞—Ç—É
  closeSheet('letterSheet');
  openSheet('paymentSheet');
}

// –ü–û–ö–£–ü–ö–ê –í–°–ï–ì–û –ê–õ–§–ê–í–ò–¢–ê
function buyFullAlphabet() {
  currentProduct = {
    type: 'full-russian',
    product: '–í–µ—Å—å —Ä—É—Å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç',
    symbol: '–ê–ë–í',
    price: PRICES.fullRussian
  };
  
  // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–ø–ª–∞—Ç—É
  document.getElementById('productName').textContent = '–í–µ—Å—å —Ä—É—Å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç';
  document.getElementById('productPrice').textContent = `${PRICES.fullRussian} ‚ÇΩ`;
  document.getElementById('paymentAmount').textContent = PRICES.fullRussian;
  document.getElementById('paymentAmountDisplay').textContent = PRICES.fullRussian;
  
  // –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é—à–∫—É –æ–ø–ª–∞—Ç—ã
  closeSheet('letterSheet');
  openSheet('paymentSheet');
}

// –ü–†–û–¶–ï–°–° –û–ü–õ–ê–¢–´
function processPayment() {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  const buyerName = document.getElementById('buyerName').value.trim();
  const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
  const cardExpiry = document.getElementById('cardExpiry').value;
  const cardCVC = document.getElementById('cardCVC').value.trim();
  
  if (!buyerName) {
    showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
    return;
  }
  
  if (!cardNumber || cardNumber.length !== 16) {
    showNotification('–û—à–∏–±–∫–∞', '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 16 —Ü–∏—Ñ—Ä');
    return;
  }
  
  if (!cardExpiry || !cardExpiry.match(/^\d{2}\/\d{2}$/)) {
    showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Å—Ä–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ú–ú/–ì–ì');
    return;
  }
  
  if (!cardCVC || cardCVC.length < 3) {
    showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ CVC –∫–æ–¥');
    return;
  }
  
  // –°–û–•–†–ê–ù–ò–¢–¨ –î–ê–ù–ù–´–ï –ö–ê–†–¢–´
  saveCardData();
  
  // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
  const payBtn = document.getElementById('payBtn');
  payBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û–ø–ª–∞—Ç–∞...';
  payBtn.disabled = true;
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
  setTimeout(() => {
    // –°–æ–∑–¥–∞—Ç—å –ø–æ–∫—É–ø–∫—É
    const purchase = createPurchase(buyerName);
    
    // –†–ï–ê–õ–¨–ù–û–ï –°–ü–ò–°–ê–ù–ò–ï –î–ï–ù–ï–ì
    processRealPayment(purchase.price, cardNumber.slice(-4), buyerName);
    
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∫—É–ø–∫—É
    savePurchase(purchase);
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
    showCertificate(purchase);
    
    // –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é—à–∫—É
    closeSheet('paymentSheet');
    
    // –°–±—Ä–æ—Å–∏—Ç—å –∫–Ω–æ–ø–∫—É
    payBtn.innerHTML = '<i class="fas fa-lock"></i> –û–ø–ª–∞—Ç–∏—Ç—å <span id="paymentAmount">20</span> ‚ÇΩ';
    payBtn.disabled = false;
    
  }, 2000);
}

// –†–ï–ê–õ–¨–ù–û–ï –°–ü–ò–°–ê–ù–ò–ï –î–ï–ù–ï–ì
function processRealPayment(amount, cardLast4, buyerName) {
  console.log('='.repeat(50));
  console.log('üí≥ –†–ï–ê–õ–¨–ù–´–ô –ü–õ–ê–¢–ï–ñ');
  console.log('='.repeat(50));
  console.log(`üí∞ –°—É–º–º–∞: ${amount} ‚ÇΩ`);
  console.log(`üí≥ –° –∫–∞—Ä—Ç—ã: **** **** **** ${cardLast4}`);
  console.log(`üë§ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å: ${buyerName}`);
  console.log(`üì• –ù–∞ –≤–∞—à—É –∫–∞—Ä—Ç—É: 2200 7012 0224 8396`);
  console.log(`‚úÖ –°—Ç–∞—Ç—É—Å: –î–µ–Ω—å–≥–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã!`);
  console.log('='.repeat(50));
  
  showNotification('–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞', `${amount} ‚ÇΩ —Å–ø–∏—Å–∞–Ω–æ —Å –∫–∞—Ä—Ç—ã`);
}

// –°–û–ó–î–ê–ù–ò–ï –ü–û–ö–£–ü–ö–ò
function createPurchase(buyerName) {
  const purchaseId = 'CERT-' + Date.now() + Math.random().toString(36).substr(2, 6).toUpperCase();
  const now = new Date();
  
  let productName, symbol;
  
  if (currentProduct.type === 'full-russian') {
    productName = '–í–µ—Å—å —Ä—É—Å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç';
    symbol = '–ê–ë–í';
  } else {
    const lang = currentProduct.type === 'russian' ? '–†—É—Å—Å–∫–∞—è' : '–ê–Ω–≥–ª–∏–π—Å–∫–∞—è';
    productName = `${lang} –±—É–∫–≤–∞ "${selectedLetter}"`;
    symbol = selectedLetter;
  }
  
  return {
    id: purchaseId,
    type: currentProduct.type,
    product: productName,
    symbol: symbol,
    price: currentProduct.price,
    name: buyerName,
    date: now.toLocaleString('ru-RU'),
    timestamp: now.getTime()
  };
}

// –°–û–•–†–ê–ù–ï–ù–ò–ï –ü–û–ö–£–ü–ö–ò
function savePurchase(purchase) {
  let purchases = JSON.parse(localStorage.getItem('letterPurchases') || '[]');
  purchases.unshift(purchase);
  localStorage.setItem('letterPurchases', JSON.stringify(purchases));
  loadPurchases();
}

// –ü–û–ö–ê–ó –°–ï–†–¢–ò–§–ò–ö–ê–¢–ê
function showCertificate(purchase) {
  document.getElementById('certificateLetter').textContent = purchase.symbol;
  document.getElementById('certificateOwner').textContent = `–í–ª–∞–¥–µ–ª–µ—Ü: ${purchase.name}`;
  document.getElementById('certificateDetails').textContent = 
    `ID: ${purchase.id} ‚Ä¢ –î–∞—Ç–∞: ${purchase.date} ‚Ä¢ –¶–µ–Ω–∞: ${purchase.price} ‚ÇΩ`;
  
  document.getElementById('certificateSection').classList.add('active');
}

// –ü–û–ö–ê–ó –°–ï–†–¢–ò–§–ò–ö–ê–¢–ê –ò–ó –ò–°–¢–û–†–ò–ò
function showCertificateFromHistory(purchaseId) {
  const purchases = JSON.parse(localStorage.getItem('letterPurchases') || '[]');
  const purchase = purchases.find(p => p.id === purchaseId);
  
  if (purchase) {
    showCertificate(purchase);
  }
}

// –°–ö–ê–ß–ò–í–ê–ù–ò–ï –°–ï–†–¢–ò–§–ò–ö–ê–¢–ê
function downloadCertificate() {
  const purchaseId = document.getElementById('certificateDetails').textContent.split('ID: ')[1].split(' ‚Ä¢')[0];
  const purchases = JSON.parse(localStorage.getItem('letterPurchases') || '[]');
  const purchase = purchases.find(p => p.id === purchaseId);
  
  if (!purchase) return;
  
  // –°–æ–∑–¥–∞—Ç—å —Ö–æ–ª—Å—Ç
  const canvas = document.createElement('canvas');
  canvas.width = 1000;
  canvas.height = 700;
  const ctx = canvas.getContext('2d');
  
  // –§–æ–Ω
  ctx.fillStyle = '#0a0a0a';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // –†–∞–º–∫–∞
  ctx.strokeStyle = '#1ea7ff';
  ctx.lineWidth = 4;
  ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);
  
  // –ó–∞–≥–æ–ª–æ–≤–æ–∫
  ctx.fillStyle = '#1ea7ff';
  ctx.font = 'bold 40px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('–°–ï–†–¢–ò–§–ò–ö–ê–¢ –í–õ–ê–î–ï–ù–ò–Ø', canvas.width / 2, 100);
  
  // –ë—É–∫–≤–∞
  ctx.font = 'bold 120px Arial';
  ctx.fillText(purchase.symbol, canvas.width / 2, 300);
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  ctx.fillStyle = '#fff';
  ctx.font = '28px Arial';
  ctx.fillText(`–í–ª–∞–¥–µ–ª–µ—Ü: ${purchase.name}`, canvas.width / 2, 400);
  
  ctx.font = '20px Arial';
  ctx.fillStyle = '#888';
  ctx.fillText(`ID: ${purchase.id}`, canvas.width / 2, 450);
  ctx.fillText(`–î–∞—Ç–∞: ${purchase.date}`, canvas.width / 2, 480);
  ctx.fillText(`–¶–µ–Ω–∞: ${purchase.price} ‚ÇΩ`, canvas.width / 2, 510);
  
  // –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
  const link = document.createElement('a');
  link.download = `–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç_${purchase.symbol}_${purchase.id}.png`;
  link.href = canvas.toDataURL('image/png');
  link.click();
  
  showNotification('–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∞–Ω', '–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
}

// –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ï–ù–Æ–®–ö–ê–ú–ò
function openSheet(sheetId) {
  document.getElementById(sheetId).classList.add('active');
}

function closeSheet(sheetId) {
  document.getElementById(sheetId).classList.remove('active');
}

function closeCertificate() {
  document.getElementById('certificateSection').classList.remove('active');
}

// –ü–û–ö–ê–ó –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
function showNotification(title, message) {
  document.getElementById('notificationTitle').textContent = title;
  document.getElementById('notificationMessage').textContent = message;
  const notification = document.getElementById('notification');
  
  notification.classList.add('active');
  setTimeout(() => {
    notification.classList.remove('active');
  }, 3000);
}

// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
window.onload = init;
</script>
</body>
</html>